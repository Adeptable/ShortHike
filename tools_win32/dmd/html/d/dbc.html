
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!--
	Copyright (c) 1999-2006 by Digital Mars
	All Rights Reserved
	Written by Walter Bright
	www.digitalmars.com
  -->


<!-- Mirrored from www.shorthike.com/trac/browser/trunk/tools_win32/dmd/html/d/dbc.html?format=raw by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 01 May 2010 04:32:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>D Programming Language - Contract Programming</title>
<link rel="stylesheet" type="text/css" href="style.html" />
<link rel="shortcut icon" href="favicon.html" />
</head>

<body>
<div id="heading">
	<a href="http://www.digitalmars.com/"><img src="dmlogo.html" width="270" height="53" style="border-style:none" alt="www.digitalmars.com"></a>

	<div id="headingNav">
	<ul>	<li><a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/DBC" title="Read/write comments and feedback">Comments</a></li>
	<li><a href="index.html" title="D Programming Language" class="dlink">D</a></li>
	<li><a href="http://www.digitalmars.com/advancedsearch.html" title="Search Digital Mars web site">Search</a></li>
	<li><a href="download.html" title="download D">Downloads</a></li>
	<li><a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a></li>
	</ul>
	</div>

	<div id="lastupdate">Last update Tue Jun  6 16:38:20 2006
</div>
</div>

<!-- Generated by Ddoc from dbc.d -->



<div id="navigation">
  
<div class="navblock">
<form method="get" action="http://www.google.com/search">
<div id="searchbox">
<input id="q" name="q" size="10" value="Search" onFocus='if(this.value == "Search"){this.value="";}'>
<input type="hidden" id="domains" name="domains" value="www.digitalmars.com">
<input type="hidden" id="sitesearch" name="sitesearch" value="www.digitalmars.com/d">
<input type="hidden" id="sourceid" name="sourceid" value="google-search">
<input type="submit" id="submit" name="submit" value="Go">
</div>
</form>
<div id="toctop">
    <ul>	<li><a href="index.html" title="D Programming Language">D ...</a></li>
	<li><a href="lex.html" title="D Language Specification">Language ...</a></li>
	<li><a href="phobos/phobos.html" title="D Runtime Library">Phobos ...</a></li>
	<li><a href="comparison.html" title="Language Comparisons">Comparisons ...</a></li>
    </ul>
</div>
</div>

  
    <div class="navblock">
    <ul>	<li><a href="lex.html">Lexical</a></li>

	<li><a href="module.html">Modules</a></li>

	<li><a href="declaration.html">Declarations</a></li>

	<li><a href="type.html">Types</a></li>

	<li><a href="property.html">Properties</a></li>

	<li><a href="attribute.html">Attributes</a></li>

	<li><a href="pragma.html">Pragmas</a></li>

	<li><a href="expression.html">Expressions</a></li>

	<li><a href="statement.html">Statements</a></li>

	<li><a href="arrays.html">Arrays</a></li>

	<li><a href="struct.html">Structs &amp; Unions</a></li>

	<li><a href="class.html">Classes</a></li>

	<li><a href="interface.html">Interfaces</a></li>

	<li><a href="enum.html">Enums</a></li>

	<li><a href="function.html">Functions</a></li>

	<li><a href="operatoroverloading.html">Operator Overloading</a></li>

	<li><a href="template.html">Templates</a></li>

	<li><a href="mixin.html">Mixins</a></li>

	<li><a href="dbc.html">Contracts</a></li>

	<li><a href="version.html">Conditional Compilation</a></li>

	<li><a href="errors.html">Handling errors</a></li>

	<li><a href="garbage.html">Garbage Collection</a></li>

	<li><a href="float.html">Floating Point</a></li>

	<li><a href="iasm.html">Inline Assembler</a></li>

	<li><a href="ddoc.html">Documentation Comments</a></li>

	<li><a href="interfaceToC.html">Interfacing To C</a></li>

	<li><a href="portability.html">Portability Guide</a></li>

	<li><a href="html.html">Embedding D in HTML</a></li>

	<li><a href="entity.html">Named Character Entities</a></li>

	<li><a href="abi.html">Application Binary Interface</a></li>

    </ul>
    </div>

</div>
<div id="content">
  <h1>     Contract Programming</h1>
  
	Contracts are a breakthrough technique to reduce the programming effort
	for large projects. Contracts are the concept of preconditions, postconditions,
	errors, and invariants.
	Contracts can be done in C++ without modification to the language,
	but the result is
	clumsy and inconsistent.
	<p>

	Building contract support into the language makes for:

	<ol>
	<li> a consistent look and feel for the contracts
	<li> tool support
	<li> it's possible the compiler can generate better code using information gathered
	from the contracts
	<li> easier management and enforcement of contracts
	<li> handling of contract inheritance
	</ol>

<img src="d4.html" alt="Contracts make D bug resistant" border=0>

	The idea of a contract is simple - it's just an expression that must evaluate to true.
	If it does not, the contract is broken, and by definition, the program has a bug in it.
	Contracts form part of the specification for a program, moving it from the documentation
	to the code itself. And as every programmer knows, documentation tends to be incomplete,
	out of date, wrong, or non-existent. Moving the contracts into the code makes them
	verifiable against the program.

<h2>Assert Contract</h2>

	The most basic contract is the
	<a href="expression.html#AssertExpression">assert</a>.
	An assert inserts a checkable expression into
	the code, and that expression must evaluate to true:
<pre class="d_code"><span class="d_keyword">assert</span>(expression);
</pre>
	C programmers will find it familiar. Unlike C, however, an <code>assert</code>
	in function bodies
	works by throwing an <code>AssertException</code>,
	which can be caught and handled. Catching the contract violation is useful
	when the code must deal with errant uses by other code, when it must be
	failure proof, and as a useful tool for debugging.

<h2>Pre and Post Contracts</h2>

	The pre contracts specify the preconditions before a statement is executed. The most
	typical use of this would be in validating the parameters to a function. The post
	contracts validate the result of the statement. The most typical use of this
	would be in validating the return value of a function and of any side effects it has.
	The syntax is:

<pre class="d_code"><span class="d_keyword">in</span>
{
    ...contract preconditions...
}
<span class="d_keyword">out</span> (result)
{
    ...contract postconditions...
}
<span class="d_keyword">body</span>
{
    ...code...
}
</pre>
	By definition, if a pre contract fails, then the body received bad parameters.
	An InException is thrown. If a post contract fails,
	then there is a bug in the body. An OutException is thrown.
<p>
	Either the <code>in</code> or the <code>out</code> clause can be omitted.
	If the <code>out</code> clause is for a function
	body, the variable <code>result</code> is declared and assigned the return
	value of the function.
	For example, let's implement a square root function:
<pre class="d_code"><span class="d_keyword">long</span> square_root(<span class="d_keyword">long</span> x)
    <span class="d_keyword">in</span>
    {
	<span class="d_keyword">assert</span>(x &gt;= 0);
    }
    <span class="d_keyword">out</span> (result)
    {
	<span class="d_keyword">assert</span>((result * result) == x);
    }
    <span class="d_keyword">body</span>
    {
	<span class="d_keyword">return</span> math.sqrt(x);
    }
</pre>
	The assert's in the in and out bodies are called <dfn>contracts</dfn>.
	Any other D
	statement or expression is allowed in the bodies, but it is important
	to ensure that the
	code has no side effects, and that the release version of the code
	will not depend on any 	effects of the code.
	For a release build of the code, the in and out code is not
	inserted.
<p>
	If the function returns a void, there is no result, and so there can be no
	result declaration in the out clause.
	In that case, use:
<pre class="d_code"><span class="d_keyword">void</span> func()
   <span class="d_keyword">out</span>
   {
	...contracts...
   }
   <span class="d_keyword">body</span>
   {
	...
   }
</pre>
	In an out statement, <i>result</i> is initialized and set to the
	return value of the function.
<p>
	The compiler can be adjusted to verify that every in and inout parameter is referenced
	in the <code>in { }</code>,
	and every out and inout parameter is referenced in the <code>out { }</code>.
<p>
	The in-out statement can also be used inside a function, for example, it can be used
	to check the results of a loop:
<pre class="d_code"><span class="d_keyword">in</span>
{
    <span class="d_keyword">assert</span>(j == 0);
}
<span class="d_keyword">out</span>
{
    <span class="d_keyword">assert</span>(j == 10);
}
<span class="d_keyword">body</span>
{
    <span class="d_keyword">for</span> (i = 0; i &lt; 10; i++)
	j++;
}
</pre>
	This is not implemented at this time.

<h2>In, Out and Inheritance</h2>

	If a function in a derived class overrides a function in its
	super class, then only one of
	the <tt>in</tt> contracts of the function and its base functions
	must be satisified.
	Overriding
	functions then becomes a process of <i>loosening</i> the <tt>in</tt>
	contracts.
	<p>

	A function without an <tt>in</tt> contract means that any values
	of the function parameters are allowed. This implies that if any
	function in an inheritance heirarchy has no <tt>in</tt> contract,
	then <tt>in</tt> contracts on functions overriding it have no useful
	effect.
	<p>

	Conversely, all of the <tt>out</tt> contracts needs to be satisified, so
	overriding functions becomes a processes of <i>tightening</i> the <tt>out</tt>
	contracts.

<!--
<h2>Errors</h2>
<p>
	A function can specify the errors it can generate. Since the D way to handle
	errors is via exceptions, a function declaration lists the exceptions it
	can generate with the exception specification:
------
void func()
    throw (FuncException, BlahException)
{
    ...
}
------
	If there is no exception specification, a function can throw any
	exception. If there is an empty exception specification:
------
void func()
    throw()
{
    ...
}
------
	then the function is defined to not throw any exceptions. If a function
	throws an exception when it is defined to not throw any exceptions,
	the program will be aborted.
<p>
	Specifying the possible exceptions opens the possibility to make a tool
	that, for each use of a function in a program, will throw each of the
	exceptions. This will be an invaluable tool to aid in testing of a program.
	For example, if a particular function can fail due to running out of memory,
	this can actually be tested for each use of that function.
-->

<h2>Class Invariants</h2>

	Class invariants are used to specify characteristics of a class that always
	must be true (except while executing a member function).
	They are described in <a href="class.html">Classes</a>.


<h2>References</h2>

<a href="http://people.cs.uchicago.edu/~robby/contract-reading-list/">Contracts Reading List</a><br>
<a href="http://pandonia.canberra.edu.au/java/contracts/paper-long.html">Adding Contracts to Java</a><br>


  
<br><br>
<br><br>
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="3651639259";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="../../../../../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

</div>





<div id="copyright">
Copyright &copy; 1999-2006 by Digital Mars, All Rights Reserved |
Page generated by <a href="http://www.digitalmars.com/d/ddoc.html">Ddoc</a>. |
<a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/DBC" title="Read/write comments and feedback">Comments</a>
</div>

</body>

<!-- Mirrored from www.shorthike.com/trac/browser/trunk/tools_win32/dmd/html/d/dbc.html?format=raw by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 01 May 2010 04:32:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>

