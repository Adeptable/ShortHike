
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!--
	Copyright (c) 1999-2006 by Digital Mars
	All Rights Reserved
	Written by Walter Bright
	www.digitalmars.com
  -->


<!-- Mirrored from www.shorthike.com/trac/browser/trunk/tools_win32/dmd/html/d/windows.html?format=raw by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 01 May 2010 04:37:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>D Programming Language - Windows</title>
<link rel="stylesheet" type="text/css" href="style.html" />
<link rel="shortcut icon" href="favicon.html" />
</head>

<body>
<div id="heading">
	<a href="http://www.digitalmars.com/"><img src="dmlogo.html" width="270" height="53" style="border-style:none" alt="www.digitalmars.com"></a>

	<div id="headingNav">
	<ul>	<li><a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/Windows" title="Read/write comments and feedback">Comments</a></li>
	<li><a href="index.html" title="D Programming Language" class="dlink">D</a></li>
	<li><a href="http://www.digitalmars.com/advancedsearch.html" title="Search Digital Mars web site">Search</a></li>
	<li><a href="download.html" title="download D">Downloads</a></li>
	<li><a href="http://www.digitalmars.com/" title="www.digitalmars.com">Home</a></li>
	</ul>
	</div>

	<div id="lastupdate">Last update Tue Jun  6 16:38:20 2006
</div>
</div>

<!-- Generated by Ddoc from windows.d -->



<div id="navigation">
  
<div class="navblock">
<form method="get" action="http://www.google.com/search">
<div id="searchbox">
<input id="q" name="q" size="10" value="Search" onFocus='if(this.value == "Search"){this.value="";}'>
<input type="hidden" id="domains" name="domains" value="www.digitalmars.com">
<input type="hidden" id="sitesearch" name="sitesearch" value="www.digitalmars.com/d">
<input type="hidden" id="sourceid" name="sourceid" value="google-search">
<input type="submit" id="submit" name="submit" value="Go">
</div>
</form>
<div id="toctop">
    <ul>	<li><a href="index.html" title="D Programming Language">D ...</a></li>
	<li><a href="lex.html" title="D Language Specification">Language ...</a></li>
	<li><a href="phobos/phobos.html" title="D Runtime Library">Phobos ...</a></li>
	<li><a href="comparison.html" title="Language Comparisons">Comparisons ...</a></li>
    </ul>
</div>
</div>

  
    <div class="navblock">
	<ul>		<li><a href="overview.html">Overview</a></li>

		<li><a href="windows.html">D for Win32</a></li>

		<li><a href="dll.html">Win32 DLLs in D</a></li>

		<li><a href="htomodule.html">C .h to D Modules</a></li>

		<li><a href="faq.html">FAQ</a></li>

		<li><a href="dstyle.html">Style Guide</a></li>

		<li><a href="wc.html">Example: wc</a></li>

		<li><a href="future.html">Future</a></li>

		<li><a href="changelog.html">D Change Log</a></li>

		<li><a href="http://www.digitalmars.com/techtips/index.html">Tech Tips</a></li>

		<li><a href="rationale.html">Rationale</a></li>

		<li><a href="warnings.html">Warnings</a></li>

	</ul>
    </div>

    <div class="navblock">
	<h2>Articles</h2>
	<ul>		<li><a href="memory.html">Memory Management</a></li>

		<li><a href="exception-safe.html">Exception Safety</a></li>

		<li><a href="templates-revisited.html">Templates Revisited</a></li>

		<li><a href="regular-expression.html">Regular Expressions</a></li>

	</ul>
    </div>

    <div class="navblock">
	<h2>Tools</h2>
	<ul>		<li><a href="dcompiler.html">DMD D Compiler</a></li>

		<li><a href="http://dgcc.sourceforge.net/">GDC D Compiler</a></li>

		<li><a href="http://www.digitalmars.com/ctg/optlink.html">Linker</a></li>

		<li><a href="http://www.digitalmars.com/ctg/trace.html">Profiler</a></li>

		<li><a href="code_coverage.html">Code Coverage</a></li>

		<li><a href="rdmd.html">DMD Script Shell</a></li>

		<li><a href="windbg.html">Windows Debugger</a></li>

		<li><a href="htod.html">C .h to D .d</a></li>

		<li><a href="http://www.prowiki.org/wiki4d/wiki.cgi?EditorSupport">Editors</a></li>

		<li><a href="http://www.prowiki.org/wiki4d/wiki.cgi?ReferenceForTools">More Tools</a></li>

	</ul>
    </div>

    <div class="navblock">
	<h2>Community</h2>
	<ul>		
		<li><a href="http://www.digitalmars.com/NewsGroup.html">News</a></li>

		<li><a href="http://www.digitalmars.com/drn-bin/wwwnews?digitalmars.D">Forum</a></li>

		<li><a href="http://www.digitalmars.com/drn-bin/wwwnews?digitalmars.D.announce">Announcements</a></li>

		<li><a href="http://www.digitalmars.com/drn-bin/wwwnews?digitalmars.D.learn">Learn</a></li>

		<li><a href="dlinks.html">D links</a></li>

	</ul>
    </div>

    <div class="navblock">
	<h2>Archives</h2>
	<ul>		<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/index.html">digitalmars.D</a></li>

		<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/dtl/index.html">digitalmars.D.dtl</a></li>

		<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/announce/index.html">digitalmars.D.announce</a></li>

		<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/dwt/index.html">digitalmars.D.dwt</a></li>

		<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/learn/index.html">digitalmars.D.learn</a></li>

		<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/bugs/index.html">digitalmars.D.bugs</a></li>

		<li><a href="http://www.digitalmars.com/d/archives/D/gnu/index.html">D.gnu</a></li>

		<li><a href="http://www.digitalmars.com/d/archives/index.html">Old D</a></li>

	</ul>
    </div>

    <div class="navblock">
	<h2>Appendices</h2>
	<ul>		<li><a href="glossary.html">Glossary</a></li>

		<li><a href="ascii-table.html">Ascii Table</a></li>

		<li><a href="acknowledgements.html">Acknowledgements</a></li>

	</ul>
    </div>


</div>
<div id="content">
  <h1>        D for Win32</h1>
  
	This describes the D implementation for 32 bit Windows systems. Naturally,
	Windows specific D features are not portable to other platforms.
	<p>

	Instead of the:
<pre class="ccode">#include &lt;windows.h&gt;
</pre>
	of C, in D there is:
<pre class="d_code"><span class="d_keyword">import</span> std.c.windows.windows;
</pre>


<h2>Calling Conventions</h2>

	In C, the Windows API calling conventions are __stdcall. In D,
	it is simply:

<pre class="d_code"><span class="d_keyword">extern</span> (Windows)
{
	<span class="d_comment">/* ... function declarations ... */</span>
}
</pre>


	The Windows linkage attribute sets both the calling convention
	and the name mangling scheme to be compatible with Windows.
	<p>

	For functions that in C would be __declspec(dllimport) or
	__declspec(dllexport), use the export attribute:

<pre class="d_code"><span class="d_keyword">export</span> <span class="d_keyword">void</span> func(<span class="d_keyword">int</span> foo);
</pre>

	If no function body is given, it's imported. If a function body
	is given, it's exported.

<h2>Windows Executables</h2>

	Windows GUI applications can be written with D.
	A sample such can be found in <tt>\dmd\samples\d\winsamp.d</tt>
	<p>

	These are required:
	<ol>

	<li> Instead of a <tt>main</tt> function serving as the entry point,
	a <tt>WinMain</tt> function is needed.

	<li> <tt>WinMain</tt> must follow this form:
<pre class="d_code"><span class="d_keyword">import</span> std.c.windows.windows;

<span class="d_keyword">extern</span> (C) <span class="d_keyword">void</span> gc_init();
<span class="d_keyword">extern</span> (C) <span class="d_keyword">void</span> gc_term();
<span class="d_keyword">extern</span> (C) <span class="d_keyword">void</span> _minit();
<span class="d_keyword">extern</span> (C) <span class="d_keyword">void</span> _moduleCtor();
<span class="d_keyword">extern</span> (C) <span class="d_keyword">void</span> _moduleDtor();
<span class="d_keyword">extern</span> (C) <span class="d_keyword">void</span> _moduleUnitTests();

<span class="d_keyword">extern</span> (Windows)
<span class="d_keyword">int</span> <b>WinMain</b>(HINSTANCE hInstance,
	HINSTANCE hPrevInstance,
	LPSTR lpCmdLine,
	<span class="d_keyword">int</span> nCmdShow)
{
    <span class="d_keyword">int</span> result;

    gc_init();			<span class="d_comment">// initialize garbage collector
</span>    _minit();			<span class="d_comment">// initialize module constructor table
</span>
    <span class="d_keyword">try</span>
    {
	_moduleCtor();		<span class="d_comment">// call module constructors
</span>	_moduleUnitTests();	<span class="d_comment">// run unit tests (optional)
</span>
	result = <b>myWinMain</b>(hInstance, hPrevInstance, lpCmdLine, nCmdShow);

	_moduleDtor();		<span class="d_comment">// call module destructors
</span>    }

    <span class="d_keyword">catch</span> (Object o)		<span class="d_comment">// catch any uncaught exceptions
</span>    {
	MessageBoxA(<span class="d_keyword">null</span>, <span class="d_keyword">cast</span>(<span class="d_keyword">char</span> *)o.toString(), <span class="d_string">"Error"</span>,
		    MB_OK | MB_ICONEXCLAMATION);
	result = 0;		<span class="d_comment">// failed
</span>    }

    gc_term();			<span class="d_comment">// run finalizers; terminate garbage collector
</span>    <span class="d_keyword">return</span> result;
}

<span class="d_keyword">int</span> <b>myWinMain</b>(HINSTANCE hInstance,
	HINSTANCE hPrevInstance,
	LPSTR lpCmdLine,
	<span class="d_keyword">int</span> nCmdShow)
{
    <span class="d_comment">/* ... insert user code here ... */</span>
}
</pre>

	The <tt>myWinMain()</tt> function is where the user code goes, the
	rest of <tt>WinMain</tt> is boilerplate to initialize and shut down
	the D runtime system.

	<li> A .def
	(<a href="http://www.digitalmars.com/ctg/ctgDefFiles.html">Module Definition File</a>)
	with at least the following
	two lines in it:

<pre class="moddeffile">EXETYPE NT
SUBSYSTEM WINDOWS
</pre>



	Without those, Win32 will open a text console window whenever
	the application is run.

	<li> The presence of <tt>WinMain()</tt> is recognized by the compiler
		causing it to emit a reference to
		<a href="http://www.digitalmars.com/ctg/acrtused.html">__acrtused_dll</a>
		and the phobos.lib runtime library.
	</ol>

  
<br><br>
<br><br>
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="3651639259";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="../../../../../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

</div>





<div id="copyright">
Copyright &copy; 1999-2006 by Digital Mars, All Rights Reserved |
Page generated by <a href="http://www.digitalmars.com/d/ddoc.html">Ddoc</a>. |
<a href="http://www.prowiki.org/wiki4d/wiki.cgi?DocComments/Windows" title="Read/write comments and feedback">Comments</a>
</div>

</body>

<!-- Mirrored from www.shorthike.com/trac/browser/trunk/tools_win32/dmd/html/d/windows.html?format=raw by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 01 May 2010 04:37:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>

